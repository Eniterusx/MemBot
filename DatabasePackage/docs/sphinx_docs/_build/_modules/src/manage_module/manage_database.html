
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>src.manage_module.manage_database &#8212; Database Package 1.0.0. documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for src.manage_module.manage_database</h1><div class="highlight"><pre>
<span></span><span class="c1"># pylint: disable=line-too-long,import-error</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module regarding managing database records.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">DatabasePackage.src.connection_module.maintain_connection_to_database</span> <span class="kn">import</span> <span class="n">Connection</span>

<span class="n">PICTURE_REMOVE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
<span class="n">PICTURE_SUCCESS</span> <span class="o">=</span> <span class="mi">2</span>


<div class="viewcode-block" id="ManageDatabase"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase">[docs]</a><span class="k">class</span> <span class="nc">ManageDatabase</span><span class="p">(</span><span class="n">Connection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class used to write, change, delete, find and manipulate records in a database.</span>

<span class="sd">------------------------------------------------------------------------------------------------------------------------</span>

<span class="sd">    !IMPORTANT!</span>
<span class="sd">        -   No individual attributes in ManageDatabase class. Only those from witch this class inherits.</span>

<span class="sd">        -   It is advised to be VERY careful, while using any methods from this class, because any correct</span>
<span class="sd">            action (syntax-wise) is automatically committed to the server and is irreversible in an easy way.</span>

<span class="sd">        -   Because this class inherits from Connection it contains more methods than shown here.</span>

<span class="sd">------------------------------------------------------------------------------------------------------------------------</span>

<span class="sd">    Songs, with which this class was made:</span>
<span class="sd">        -   BLACK SABBATH, &quot;Paranoid&quot;.</span>
<span class="sd">        -   WORKERS &amp; RESOURCES: SOVIET REPUBLIC GAME SOUNDTRACK</span>
<span class="sd">        -   DEFTONES, &quot;My Own Summer&quot;</span>
<span class="sd">        -   Taco Hemingway, &quot;Polskie Tango&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        **Default constructor**, that takes parameters needed to start connection to a MYSQL server using</span>
<span class="sd">        :class:`mysql.connector`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ManageDatabase class representation method.</span>

<span class="sd">        :return:    Class representation, formatted in a specific way.</span>
<span class="sd">        :rtype:     str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(_host=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_host</span><span class="si">}</span><span class="s1">, _port=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_port</span><span class="si">}</span><span class="s1">, _dbname=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dbname</span><span class="si">}</span><span class="s1">, &#39;</span> \
               <span class="sa">f</span><span class="s1">&#39;_user=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_user</span><span class="si">}</span><span class="s1">, _password=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_password</span><span class="si">}</span><span class="s1">, _is_connected=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_connected</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to enter with &quot;with&quot; statement. It serves a purpose, because you do not have to think, about</span>
<span class="sd">        starting a connection to a database. Program enables connection automatically, when you start a &quot;with&quot;</span>
<span class="sd">        statement.</span>

<span class="sd">        :return:    Object created with &quot;with&quot; command, that is automatically connected to a database.</span>
<span class="sd">        :rtype:     ManageDatabase</span>

<span class="sd">        :except mysql.connector.Error:  Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:           Exception from &quot;connection_exceptions.py&quot; file, created by Dominik Breksa. See</span>
<span class="sd">                                        its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to exit the &quot;with&quot; statement. It serves a purpose, because you do not have to think, about closing</span>
<span class="sd">        a connection to a database. Program disables connection automatically, when you end a &quot;with&quot; statement.</span>

<span class="sd">        :except mysql.connector.Error:  Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except TooMuchConnections:     Exception from &quot;connection_exceptions.py&quot; file, created by Dominik Breksa. See</span>
<span class="sd">                                        its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="ManageDatabase.add_user"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.add_user">[docs]</a>    <span class="k">def</span> <span class="nf">add_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discord_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nickname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to add user to a database.</span>

<span class="sd">        In order to fully understand its arguments, see the latest ER Diagram made by Dominik Breksa which is in</span>
<span class="sd">        database_info_schema folder (erd.PNG).</span>

<span class="sd">        :param discord_id:  Value for &quot;discord_id&quot; colum in Users table.</span>
<span class="sd">        :type discord_id:   int</span>

<span class="sd">        :param nickname:    Discord nickname of an account that you want to add to a database.</span>
<span class="sd">        :type nickname:     str</span>

<span class="sd">        :return:    Returns user_id of an existing user.</span>
<span class="sd">        :rtype:     int</span>

<span class="sd">        :except mysql.connector.Error:          Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:                   Exception from &quot;connection_exceptions.py&quot; file, created by</span>
<span class="sd">                                                Dominik Breksa. See its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM users WHERE discord_id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">discord_id</span><span class="p">),)</span>
        <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO users (discord_id, nickname) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">);&quot;&quot;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">discord_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">nickname</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT user_id FROM users WHERE discord_id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">discord_id</span><span class="p">),)</span>
            <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ManageDatabase.add_picture"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.add_picture">[docs]</a>    <span class="k">def</span> <span class="nf">add_picture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nickname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">discord_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">delete_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image_category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Empty&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to add picture url to a database.</span>

<span class="sd">        In order to fully understand its arguments, see the latest ER Diagram made by Dominik Breksa which is in</span>
<span class="sd">        database_info_schema folder (erd.PNG).</span>

<span class="sd">        :param nickname:        Discord nickname of an account that putted this image to a database.</span>
<span class="sd">        :type nickname:         str</span>

<span class="sd">        :param discord_id:      Value for &quot;discord_id&quot; colum in Pictures table.</span>
<span class="sd">        :type discord_id:       int</span>

<span class="sd">        :param file_name:       Value for &quot;file_name&quot; colum in Pictures table.</span>
<span class="sd">        :type file_name:        str</span>

<span class="sd">        :param file_type:       Value for &quot;file_type&quot; colum in Pictures table.</span>
<span class="sd">        :type file_type:        str</span>

<span class="sd">        :param url:             Value for &quot;url&quot; colum in Pictures table.</span>
<span class="sd">        :type url:              str</span>

<span class="sd">        :param image_hash:      Value for &quot;image_hash&quot; colum in Pictures table.</span>
<span class="sd">        :type image_hash:       str</span>

<span class="sd">        :param delete_hash:     Value for &quot;delete_hash&quot; colum in Pictures table.</span>
<span class="sd">        :type delete_hash:      str</span>

<span class="sd">        :param image_category:   Value for &quot;image_category&quot; colum in Pictures table.</span>
<span class="sd">        :type image_category:    str</span>

<span class="sd">        :return:    Returns picture_id of an existing picture if insertion was not successful.</span>
<span class="sd">        :rtype:     Optional[int]</span>

<span class="sd">        :except mysql.connector.Error:          Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:                   Exception from &quot;connection_exceptions.py&quot; file, created by</span>
<span class="sd">                                                Dominik Breksa. See its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="n">discord_id</span><span class="p">,</span> <span class="n">nickname</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM pictures WHERE url = </span><span class="si">%s</span><span class="s2"> OR image_hash = </span><span class="si">%s</span><span class="s2"> OR delete_hash = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">image_hash</span><span class="p">,</span> <span class="n">delete_hash</span><span class="p">)</span>
        <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;   INSERT INTO pictures </span>
<span class="s2">                        (user_id, file_name, file_type, url, image_hash, delete_hash, image_category) </span>
<span class="s2">                        VALUES </span>
<span class="s2">                        (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">);</span>
<span class="s2">                  &quot;&quot;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">image_hash</span><span class="p">,</span> <span class="n">delete_hash</span><span class="p">,</span> <span class="n">image_category</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ManageDatabase.add_vote"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.add_vote">[docs]</a>    <span class="k">def</span> <span class="nf">add_vote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discord_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nickname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">picture_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vote_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to add vote to the specific image by a given user.</span>

<span class="sd">        In order to fully understand its arguments, see the latest ER Diagram made by Dominik Breksa which is in</span>
<span class="sd">        database_info_schema folder (erd.PNG).</span>

<span class="sd">        :param discord_id:  Value for &quot;discord_id&quot; of a person that have voted.</span>
<span class="sd">        :type discord_id:   int</span>

<span class="sd">        :param nickname:    Discord nickname of an account that you want to add to a database.</span>
<span class="sd">        :type nickname:     str</span>

<span class="sd">        :param picture_id:  Value for &quot;picture_id&quot; colum in Votes table.</span>
<span class="sd">        :type picture_id:   int</span>

<span class="sd">        :param vote_value:  Value vote: 1 or -1 (Only options).</span>
<span class="sd">        :type vote_value:   int</span>

<span class="sd">        :return:    Returns vote_value of an existing vote record if insertion was not successful.</span>
<span class="sd">        :rtype:     Optional[int]</span>

<span class="sd">        :except mysql.connector.Error:          Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:                   Exception from &quot;connection_exceptions.py&quot; file, created by</span>
<span class="sd">                                                Dominik Breksa. See its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="n">discord_id</span><span class="p">,</span> <span class="n">nickname</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM votes WHERE user_id = </span><span class="si">%s</span><span class="s2"> AND picture_id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">picture_id</span><span class="p">))</span>
        <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;REPLACE INTO votes (user_id, picture_id, vote_value) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">);&quot;&quot;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">picture_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">vote_value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span></div>


<div class="viewcode-block" id="ManageDatabase.add_report"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.add_report">[docs]</a>    <span class="k">def</span> <span class="nf">add_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discord_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nickname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">picture_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reason_of_report</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to add vote to the specific image by a given user.</span>

<span class="sd">        In order to fully understand its arguments, see the latest ER Diagram made by Dominik Breksa which is in</span>
<span class="sd">        database_info_schema folder (erd.PNG).</span>

<span class="sd">        :param discord_id:  Value for &quot;discord_id&quot; of a person that have reported other image.</span>
<span class="sd">        :type discord_id:   int</span>

<span class="sd">        :param nickname:    Discord nickname of an account that you want to add to a database.</span>
<span class="sd">        :type nickname:     str</span>

<span class="sd">        :param picture_id:  Value for &quot;picture_id&quot; colum in Report table.</span>
<span class="sd">        :type picture_id:   int</span>

<span class="sd">        :param reason_of_report:  String of explanation, why this image was reported.</span>
<span class="sd">        :type reason_of_report:   str</span>

<span class="sd">        :return:    Returns report_id of an existing report record if insertion was not successful.</span>
<span class="sd">        :rtype:     Optional[int]</span>

<span class="sd">        :except mysql.connector.Error:          Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:                   Exception from &quot;connection_exceptions.py&quot; file, created by</span>
<span class="sd">                                                Dominik Breksa. See its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="n">discord_id</span><span class="p">,</span> <span class="n">nickname</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM pictures WHERE picture_id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">picture_id</span><span class="p">),)</span>
        <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">records</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM reports WHERE user_id = </span><span class="si">%s</span><span class="s2"> AND picture_id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">picture_id</span><span class="p">))</span>
            <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO reports (user_id, picture_id, reason_of_report) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">);&quot;&quot;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">picture_id</span><span class="p">),</span> <span class="n">reason_of_report</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ManageDatabase.update_picture"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.update_picture">[docs]</a>    <span class="k">def</span> <span class="nf">update_picture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="ManageDatabase.update_report"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.update_report">[docs]</a>    <span class="k">def</span> <span class="nf">update_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="ManageDatabase.delete_user"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.delete_user">[docs]</a>    <span class="k">def</span> <span class="nf">delete_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="ManageDatabase.delete_picture"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.delete_picture">[docs]</a>    <span class="k">def</span> <span class="nf">delete_picture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picture_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="ManageDatabase.delete_under_performing_picture"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.delete_under_performing_picture">[docs]</a>    <span class="k">def</span> <span class="nf">delete_under_performing_picture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to delete all the images that have a score value less than PICTURE_REMOVE.</span>

<span class="sd">        :except mysql.connector.Error:  Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:           Exception from &quot;connection_exceptions.py&quot; file, created by Dominik Breksa. See</span>
<span class="sd">                                        its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;   DELETE FROM pictures WHERE picture_id IN (</span>
<span class="s2">                        SELECT v.picture_id FROM votes AS v INNER JOIN (</span>
<span class="s2">                            SELECT picture_id, SUM(vote_value) AS suma FROM votes GROUP BY picture_id</span>
<span class="s2">                        ) AS s USING(picture_id)</span>
<span class="s2">                        WHERE s.suma &lt; </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                        GROUP BY picture_id</span>
<span class="s2">                    );</span>
<span class="s2">              &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PICTURE_REMOVE</span><span class="p">),)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManageDatabase.remove_reaction"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.remove_reaction">[docs]</a>    <span class="k">def</span> <span class="nf">remove_reaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statistic_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="ManageDatabase.ban"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.ban">[docs]</a>    <span class="k">def</span> <span class="nf">ban</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">days_of_ban</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reason_of_ban</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM banned WHERE report_id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">report_id</span><span class="p">),)</span>
        <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    REPLACE INTO banned (report_id, date_of_unban, reason_of_ban) VALUES  (</span><span class="si">%s</span><span class="s2">, DATE_ADD(NOW(), INTERVAL </span><span class="si">%s</span><span class="s2"> DAY), </span><span class="si">%s</span><span class="s2">);</span>
<span class="s2">                  &quot;&quot;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">report_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">days_of_ban</span><span class="p">),</span> <span class="n">reason_of_ban</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ManageDatabase.unban"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.unban">[docs]</a>    <span class="k">def</span> <span class="nf">unban</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discord_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT user_id FROM users WHERE discord_id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">discord_id</span><span class="p">),)</span>
        <span class="n">record</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;   </span>
<span class="s2">                        UPDATE banned AS b</span>
<span class="s2">                        SET b.date_of_unban = CURRENT_TIMESTAMP()</span>
<span class="s2">                        WHERE b.report_id IN(</span>
<span class="s2">                            SELECT report_id FROM banned AS ba</span>
<span class="s2">                                INNER JOIN reports AS r USING(report_id)</span>
<span class="s2">                                INNER JOIN pictures AS p USING(picture_id)</span>
<span class="s2">                            WHERE p.user_id = </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                        );</span>
<span class="s2">                  &quot;&quot;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="ManageDatabase.is_user_banned"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.is_user_banned">[docs]</a>    <span class="k">def</span> <span class="nf">is_user_banned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discord_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT user_id FROM users WHERE discord_id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">discord_id</span><span class="p">),)</span>
        <span class="n">record</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;   SELECT p.user_id FROM pictures AS p</span>
<span class="s2">                            INNER JOIN reports AS r USING(picture_id)</span>
<span class="s2">                            INNER JOIN banned AS b USING(report_id)</span>
<span class="s2">                        WHERE CURRENT_TIMESTAMP() &lt; b.date_of_unban AND p.user_id = </span><span class="si">%s</span><span class="s2">;</span>
<span class="s2">                  &quot;&quot;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),)</span>
            <span class="n">record</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="ManageDatabase.find_user"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.find_user">[docs]</a>    <span class="k">def</span> <span class="nf">find_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique_identifier</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to find specific user record using special identifier.</span>

<span class="sd">        Possible first tuple slot (zeroed index):</span>
<span class="sd">            -   &quot;user_id&quot;</span>
<span class="sd">            -   &quot;discord_id&quot;</span>

<span class="sd">        :param unique_identifier:   Two slot tuple, where the first element is always one of the columns of Users table</span>
<span class="sd">                                    that have unique constraint. And the second is the value that you want to look for.</span>
<span class="sd">        :type unique_identifier:    tuple[str, int]</span>

<span class="sd">        :return:    If the record was found, then it will return it.</span>
<span class="sd">        :rtype:     Optional[list[tuple[Any, ...]]]</span>

<span class="sd">        :except mysql.connector.Error:  Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:           Exception from &quot;connection_exceptions.py&quot; file, created by Dominik Breksa. See</span>
<span class="sd">                                        its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">find_user_user_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="s2">&quot;SELECT * FROM users WHERE user_id = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)])</span>

        <span class="k">def</span> <span class="nf">find_user_discord_id</span><span class="p">(</span><span class="n">discord_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="s2">&quot;SELECT * FROM users WHERE discord_id = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">discord_id</span><span class="p">)])</span>

        <span class="n">mode_selector</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">find_user_user_id</span><span class="p">,</span>
            <span class="s2">&quot;discord_id&quot;</span><span class="p">:</span> <span class="n">find_user_discord_id</span>
        <span class="p">}</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="n">mode_selector</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">unique_identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="n">unique_identifier</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">record</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="ManageDatabase.find_picture"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.find_picture">[docs]</a>    <span class="k">def</span> <span class="nf">find_picture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique_identifier</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to find specific picture record using special identifier.</span>

<span class="sd">        Possible first tuple slot (zeroed index):</span>
<span class="sd">            -   &quot;picture_id&quot;</span>
<span class="sd">            -   &quot;url&quot;</span>
<span class="sd">            -   &quot;image_hash&quot;</span>
<span class="sd">            -   &quot;delete_hash&quot;</span>

<span class="sd">        :param unique_identifier:   Two slot tuple, where the first element is always one of the columns of Pictures</span>
<span class="sd">                                    table that have unique constraint. And the second is the value that you want to look</span>
<span class="sd">                                    for.</span>
<span class="sd">        :type unique_identifier:    tuple[str, Any]</span>

<span class="sd">        :return:    If the record was found, then it will return it.</span>
<span class="sd">        :rtype:     Optional[list[tuple[Any, ...]]]</span>

<span class="sd">        :except mysql.connector.Error:  Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:           Exception from &quot;connection_exceptions.py&quot; file, created by Dominik Breksa. See</span>
<span class="sd">                                        its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">find_picture_picture_id</span><span class="p">(</span><span class="n">picture_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;&quot;   SELECT * FROM pictures AS p </span>
<span class="s2">                        INNER JOIN (</span>
<span class="s2">                            SELECT p.picture_id, COALESCE(SUM(v.vote_value), 0) AS suma FROM pictures AS p</span>
<span class="s2">                                LEFT JOIN votes AS v USING(picture_id)</span>
<span class="s2">                            GROUP BY p.picture_id</span>
<span class="s2">                        ) AS s USING(picture_id)</span>
<span class="s2">                    WHERE picture_id = </span><span class="si">%s</span><span class="s2"> AND picture_id NOT IN (</span>
<span class="s2">                        SELECT pa.picture_id FROM pictures AS pa</span>
<span class="s2">                            INNER JOIN reports AS ra USING(picture_id)</span>
<span class="s2">                            INNER JOIN banned AS ba USING(report_id)</span>
<span class="s2">                    )</span>
<span class="s2">                    GROUP BY picture_id</span>
<span class="s2">                    ORDER BY RAND() </span>
<span class="s2">                    LIMIT 1;</span>
<span class="s2">              &quot;&quot;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">picture_id</span><span class="p">)])</span>

        <span class="k">def</span> <span class="nf">find_picture_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="s2">&quot;SELECT * FROM pictures WHERE url = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">def</span> <span class="nf">find_picture_image_hash</span><span class="p">(</span><span class="n">image_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="s2">&quot;SELECT * FROM pictures WHERE image_hash = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">image_hash</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">def</span> <span class="nf">find_picture_delete_hash</span><span class="p">(</span><span class="n">delete_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="s2">&quot;SELECT * FROM pictures WHERE delete_hash = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">delete_hash</span><span class="p">,</span> <span class="p">)</span>

        <span class="n">mode_selector</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;picture_id&quot;</span><span class="p">:</span> <span class="n">find_picture_picture_id</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">find_picture_url</span><span class="p">,</span>
            <span class="s2">&quot;image_hash&quot;</span><span class="p">:</span> <span class="n">find_picture_image_hash</span><span class="p">,</span>
            <span class="s2">&quot;delete_hash&quot;</span><span class="p">:</span> <span class="n">find_picture_delete_hash</span>
        <span class="p">}</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="n">mode_selector</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">unique_identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="n">unique_identifier</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">record</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="ManageDatabase.find_report"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.find_report">[docs]</a>    <span class="k">def</span> <span class="nf">find_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique_identifier</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to find specific report record using special identifier.</span>

<span class="sd">        Possible first tuple slot (zeroed index) can be one of:</span>
<span class="sd">            -   &quot;report_id&quot;</span>
<span class="sd">            -   &quot;picture_id_&amp;_discord_id&quot;</span>

<span class="sd">        :param unique_identifier:   Two slot tuple, where the first element is always one of the columns of Users table</span>
<span class="sd">                                    that have unique constraint. And the second is the value that you want to look for.</span>
<span class="sd">        :type unique_identifier:    tuple[str, int]</span>

<span class="sd">        :return:    If the record was found, then it will return it.</span>
<span class="sd">        :rtype:     Optional[list[tuple[Any, ...]]]</span>

<span class="sd">        :except mysql.connector.Error:  Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:           Exception from &quot;connection_exceptions.py&quot; file, created by Dominik Breksa. See</span>
<span class="sd">                                        its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">find_report_report_id</span><span class="p">(</span><span class="n">report_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">extra</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="s2">&quot;SELECT * FROM reports WHERE report_id = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">report_id</span><span class="p">)])</span>

        <span class="k">def</span> <span class="nf">find_report_picture_id_discord_id</span><span class="p">(</span><span class="n">picture_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">discord_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM reports WHERE user_id IN (SELECT user_id FROM users WHERE discord_id = </span><span class="si">%s</span><span class="s2">) AND </span>
<span class="s2">                      picture_id = </span><span class="si">%s</span><span class="s2">;&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">discord_id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">picture_id</span><span class="p">))</span>

        <span class="n">mode_selector</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;report_id&quot;</span><span class="p">:</span> <span class="n">find_report_report_id</span><span class="p">,</span>
            <span class="s2">&quot;picture_id_&amp;_discord_id&quot;</span><span class="p">:</span> <span class="n">find_report_picture_id_discord_id</span>
        <span class="p">}</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="n">mode_selector</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">unique_identifier</span><span class="p">[</span><span class="mi">0</span><span class="p">])(</span><span class="n">unique_identifier</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">unique_identifier</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">record</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">record</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ManageDatabase.random_picture"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.random_picture">[docs]</a>    <span class="k">def</span> <span class="nf">random_picture</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to get a random picture record that has a score value grater than PICTURE_SUCCESS.</span>

<span class="sd">        :return:    If the record was found, then it will return it.</span>
<span class="sd">        :rtype:     Optional[list[tuple[Any, ...]]]</span>

<span class="sd">        :except mysql.connector.Error:  Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:           Exception from &quot;connection_exceptions.py&quot; file, created by Dominik Breksa. See</span>
<span class="sd">                                        its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;   SELECT * FROM pictures AS p </span>
<span class="s2">                        INNER JOIN (</span>
<span class="s2">                            SELECT p.picture_id, COALESCE(SUM(v.vote_value), 0) AS suma FROM pictures AS p</span>
<span class="s2">                                LEFT JOIN votes AS v USING(picture_id)</span>
<span class="s2">                            GROUP BY p.picture_id</span>
<span class="s2">                        ) AS s USING(picture_id)</span>
<span class="s2">                    WHERE s.suma &gt;= </span><span class="si">%s</span><span class="s2"> AND picture_id NOT IN (</span>
<span class="s2">                        SELECT pa.picture_id FROM pictures AS pa</span>
<span class="s2">                            INNER JOIN reports AS ra USING(picture_id)</span>
<span class="s2">                            INNER JOIN banned AS ba USING(report_id)</span>
<span class="s2">                    )</span>
<span class="s2">                    GROUP BY picture_id</span>
<span class="s2">                    ORDER BY RAND() </span>
<span class="s2">                    LIMIT 1;</span>
<span class="s2">              &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PICTURE_SUCCESS</span><span class="p">),)</span>
        <span class="n">record</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">record</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ManageDatabase.random_picture_wait_room"><a class="viewcode-back" href="../../../manage_module.html#src.manage_module.manage_database.ManageDatabase.random_picture_wait_room">[docs]</a>    <span class="k">def</span> <span class="nf">random_picture_wait_room</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to get a random picture record from waiting room (score value less than PICTURE_SUCCESS).</span>

<span class="sd">        :return:    If the record was found, then it will be returned.</span>
<span class="sd">        :rtype:     Optional[list[tuple[Any, ...]]]</span>

<span class="sd">        :except mysql.connector.Error:  Any of the exception from &quot;mysql.connector&quot; libreary.</span>
<span class="sd">        :except NoConnection:           Exception from &quot;connection_exceptions.py&quot; file, created by Dominik Breksa. See</span>
<span class="sd">                                        its description to understand its occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;   SELECT * FROM pictures AS p </span>
<span class="s2">                        INNER JOIN (</span>
<span class="s2">                            SELECT p.picture_id, COALESCE(SUM(v.vote_value), 0) AS suma FROM pictures AS p</span>
<span class="s2">                                LEFT JOIN votes AS v USING(picture_id)</span>
<span class="s2">                            GROUP BY p.picture_id</span>
<span class="s2">                        ) AS s USING(picture_id)</span>
<span class="s2">                    WHERE s.suma &lt; </span><span class="si">%s</span><span class="s2"> AND picture_id NOT IN (</span>
<span class="s2">                        SELECT pa.picture_id FROM pictures AS pa</span>
<span class="s2">                            INNER JOIN reports AS ra USING(picture_id)</span>
<span class="s2">                            INNER JOIN banned AS ba USING(report_id)</span>
<span class="s2">                    )</span>
<span class="s2">                    GROUP BY picture_id</span>
<span class="s2">                    ORDER BY RAND() </span>
<span class="s2">                    LIMIT 1;</span>
<span class="s2">              &quot;&quot;&quot;</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PICTURE_SUCCESS</span><span class="p">),)</span>
        <span class="n">record</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">record</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Database Package</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Dominik Breksa, Jakub Kot.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>